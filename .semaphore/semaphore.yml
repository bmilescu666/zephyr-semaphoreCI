version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Build
    task:
      jobs:
        - name: Build
          commands:
            - checkout
            - >-
              ./scripts/ci/run_ci.sh -c -b ${SEMAPHORE_GIT_BRANCH} -r origin -m
              ${MATRIX_BUILD} -M ${MATRIX_BUILDS}
      env_vars:
        - name: MATRIX_BUILDS
          value: '5'
        - name: ZEPHYR_TOOLCHAIN_VARIANT
          value: zephyr
        - name: ZEPHYR_SDK_INSTALL_DIR
          value: /opt/sdk/zephyr-sdk-0.10.3
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu1804
        containers:
          - name: main
            image: 'zephyrprojectrtos/ci:v0.9.1'
      epilogue:
        on_pass:
          commands:
            - >-
              ./scripts/ci/run_ci.sh -s -b ${SEMAPHORE_GIT_BRANCH} -r origin -m
              ${MATRIX_BUILD} -M ${MATRIX_BUILDS}
        on_fail:
          commands:
            - >-
              ./scripts/ci/run_ci.sh -f -b ${SEMAPHORE_GIT_BRANCH} -r origin -m
              ${MATRIX_BUILD} -M ${MATRIX_BUILDS};
